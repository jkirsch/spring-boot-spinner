"use strict";var myApp=angular.module("spinner",["spinner.controllers","ngAnimate"]);
"use strict";angular.module("spinner.controllers",["spinner.services","toaster"]).controller("EntriesCtrl",["$scope","myService","toaster","$timeout",function(n,t,i,e){function o(){console.log("STOMP: Attempting connection"),r=new SockJS("/spinner"),c=Stomp.over(r),c.connect({},l,f)}var r,c;n.participants=[],n.winner="",n.newName="",n.connected=0,n.spinning=!1,n.add=function(){var e={name:n.newName.trim()};i.clear(),t.create(e).then(function(){n.newName=""},function(n){i.pop("error","Backend error",n.message),console.log(n)})};var a=function(t){n.participants.push(t),s()},s=function(){n.spinning||(b.update(g()),n.$apply())},p=function(t){var i;for(i=0;i<n.participants.length&&n.participants[i].id!==t;i++);n.participants.splice(i,1),s()},u=function(t){n.connected=t,s()},d=function(t){n.spinning=!0;var i;for(i=0;i<n.participants.length&&n.participants[i].id!==t.id;i++);b.update(g());var o=n.participants.length-i-1,r=o*(360/n.participants.length)+360+360/n.participants.length/2,c=r+7200,a=b.spin(c);e(function(){n.winner=t,n.participants[i]=t,n.spinning=!1,n.$apply()},a.duration)},l=function(t){console.log("Connected "+t),c.subscribe("/app/participants",function(t){var i=JSON.parse(t.body);n.participants=i.entries,n.connected=i.connected,s()}),c.subscribe("/topic/added",function(n){a(JSON.parse(n.body))}),c.subscribe("/topic/deleted",function(n){p(JSON.parse(n.body))}),c.subscribe("/topic/spin",function(n){d(JSON.parse(n.body))}),c.subscribe("/topic/count",function(n){u(JSON.parse(n.body))})},f=function(n){console.log("STOMP: "+n),setTimeout(o,1e4),console.log("STOMP: Reconecting in 10 seconds")};o(),n.remove=function(n){c.send("/app/remove",{},JSON.stringify(n.id))};var g=function(){var t=[];return angular.forEach(n.participants,function(n){this.push(n.name.substring(0,8))},t),t},m=Math.min(window.innerWidth/2,220)-20,b=new Spinner("#spinnerContainer",{margins:{top:40,right:10,bottom:10,left:10},outerR:m,h:450,w:2*m+20,data:g()});n.spin=function(){i.clear(),t.spin().then(function(){n.winner=""},function(n){i.pop("error","Backend error",n.message),console.log(n)})}}]);
var myApp=angular.module("spinner.services",[]).factory("myService",["$http",function(r){var t={create:function(t){return r.post("participants/",t).then(function(r){return r.data},function(r){var t;throw r.data&&(t=r.data.message),new Error(t||"Can't talk to server - server down?")})},spin:function(){return r.get("participants/random").then(function(r){return r.data},function(r){var t;throw r.data&&(t=r.data.message),new Error(t||"Can't talk to server - server down?")})}};return t}]);